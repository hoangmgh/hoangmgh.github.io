---
layout: post
title: üìè How do we measure  correlation between matrices ?
date: 2023-10-18
description:  Correlating matrices with RV coefficient and its application to correlating genotype arrays 
tags: math bioinformatics
categories: Bioinformatics
related_posts: false
thumbnail: /assets/img/rv2_snps.png
---
**1.Matrices inner-product**


One day I woke up and asked: What if we want to define a metric to calculate the correlation between two matrices. How would that be possible? I think this can be a bit confusing, because we might not understand what we mean by "correlation". 

To clarify this questions, I think it is good to go back to our definition. In fact, I think it might be a bit more useful to use the inner-product definition becauset it might be more intuitive and leave room for generalization. The inner-product helps us to relate the formality of "length", "distance", and "angle" in a defined space. 

For correlation between two vectors in $$\mathbb{R^n}$$, we want to 

\begin{equation}
    \rho (x,y)= \frac{\langle x-\mu_x , y-\mu_y \rangle}{\|x-\mu_x\|\|y-\mu_y\|}=\cos \theta_{x,y}
\end{equation}
 In the Euclidean space, you can replace the inner-product by the dot-product and you now have the Pearson correlation:
\begin{equation}
\rho (x,y) = \frac{(x-\mu_x) \cdot (y -\mu_y) } { \|x-\mu_x\| \|y-\mu_y\|}
\end{equation}
Technically speaking, the correlation between $$x$$ and $$y$$ can represent the cosine of the angle between two vectors. It is defined as the inner-product of centered vectors $$x$$ and $$y$$, weighted down by their length (hence the denominator).


The inner product is a great concept to think about "relative" distance because it can be defined as a mapping such that
$$\langle x,x \rangle = \|x\|$$
So in the case that $$x$$ and $$y$$ are identical, the norminator reaches its maximum value, and the correlation is always at most 0. 

Now we can even generalize the inner-product to be defined for matrices, as long as your definition plays along with the formal definition of an "inner-product".In the case of matrices space, a well-known inner-product is the following. Given matrices $$A$$ and $$B \in \mathbb{R^{f \times n}}$$:
\begin{equation}
\langle A , B \rangle = tr(AB^T)    
\end{equation}
This is saying that we calculate the dot products of vectors $$a_1 \cdot b_1$$ , $$a_2 \cdot b_2$$,.... and $$a_f \cdot b_f$$. and summing them up, where $$a_i$$ and $$b_i$$ are the feature vectors of matrices $$A$$ and $$B$$ respectively. Thus the trace of $$AB^T$$ gives us a "summary" value for how different two matrices are, by pairwise calculation of their feature vectors. A very important point I want to make is that dot product is a similarity measure, so the trace is summing up all the similarity.

In the case that $$A=B$$, we have 
$$\langle A ,B \rangle= tr(AA^T) = \|a_1\|+\|a_2\|+..+\|a_f\|$$,
which are the sum of the norms of feature columns in A.  This is also similar to "flattening" the matrix and treat it as the norm of the flattened vector.  The trace inner-product is particularly useful, I believe, in the case that 
two matrices have the same size - same set of features, but different observations particularly. 

**2.RV coefficient**

For two vectors $$A$$ and $$B$$ of different size, i.e. $$A \in \mathbb{R^{f \dots n_1}} $$ and $$B \in \mathbb{R^{f \dots n_2}}$$,
there is no way that we can calculate $$\langle A B \rangle$$. (Because these two don't live on the same subspace).
And so, we can "devise" a correlation between two matrices as:
\begin{equation}
    \frac{\sum_{i=1}^f a_i b_i}{\sum_{i=1}^f \|a_i\|\sum_{i=1}^f \|b_i\|}
\end{equation}
In the case that $$A$$ and $$B$$ are of different size, but similiar set of features, we might want to calculate something like this:

\begin{equation}
   \rho(A,B) = \frac{\langle AA^T, BB^T \rangle}{\|AA^T\|\|BB^T\|} =\frac{tr(AA^TBB^T)}{\|AA^T\|\|BB^T\|}
 \end{equation}
Okay! So what this coefficient is measuring is basically the averaged similarity in the correlation pattern of the two matrices' feature sets. 
 I then went on to try this measure on  our genotype data. 

 **3.Application of the RV coefficient on single-cell genotype matrices**
 When thinking about a correlation matrix, I was planning to use this for comparing genotype matrices across different 