---
layout: post
title: ðŸ“ˆ Some visualization tips for scRNA-seq data
date: 2023-2-25 21:01:00
description: make informative heatmap, boxplot, dotplot, etc for your single-cell paper
tags: visualization single-cell
categories: sample-posts
thumbnail: /assets/img/boxplot_freq.png
---

While working on the Thyroid Autoimmune Disease project, I took the chance to rewrite existing visualization tools so that we can personalize them.  For example, we can add components that are useful for communicative purposes. 

While looking at the source code of [scanpy's dotplot](https://github.com/scverse/scanpy/blob/master/scanpy/plotting/_dotplot.py#L792-L987), I realize that there are two very important parameters that tend to be glossed over: **mean_only_expressed** and **DEFAULT_SIZE_EXPONENT**. To make the difference between the dots bigger, scanpy raise the size of the dots to an exponent, default at $$1.5$$. This makes dots bigger than it is expected in a linear scale. The **mean_only_expressed** is adjustable, and this controls whether one  wants to average over the non-zero value of a given gene. 


<div class="row" style="text-align: center">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/dotplot_thyroid_example.png" title="Lineage dotplot" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    A dotplot showing the defining markers of main cell types in Thyroid tissue 
</div>

One feature I really like is the horizontal strips for each cell. This is particularly useful for readers who want to navigate a specific gene in the middle of the dotplot. The other feature that might be useful is a  colorbars for the cell populations - these should also match the color of the UMAP, as well. I personally prefer to set the color for the doublets as gray, because it is biologically interesting and we want readers to gloss over this population. For example, this dotplot can go really well with the UMAP:


<div class="row" style="text-align: center">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/umap_thyroid_example.png" title="Lineage dotplot" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    An UMAP showing  main cell types in Thyroid tissue 
</div>

Another modification we can make to the scanpy dotplot is plotting protein and RNA at the same time, side-by-side, using a different cmap, e.g. Reds for RNA and Blues for Protein. I find this quite satisfying visually:

<div class="row" style="text-align: center">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/dotplot_thyroid_example2.png" title="Lineage dotplot" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    A dotplot showing the defining markers of main B-cell subtypes in the Thyroid dataset
</div>


<font size="5"> 2. Boxplot for cell population's frequency </font> 
We can also use the same dark grey and white strips to aid the reading in boxplot as well:

<div class="row" style="text-align: center">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/boxplot_thyroid.png" title="Lineage boxplot" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    A boxplot showing the frequency of different cell types in the Thyroid tissue
</div>

I also mix boxplot with stripplot in seaborn, which wiggle dots vertically or horizontally so that they don't overlay each other. This can be particularly useful if we have densely packed dots. Moreover, we can also set the color of the dots and the boxplots to be the same. We also decided to, for example, set the color of the immune cells to the red-brown shades, while the non-lymphocytes the green-blue shades. 

Simultaneously, it can be useful to break down your boxplot into multiple subplots. In our example, the Epithelial has a very frequency compared to other cell types, so it might be helpful to put them as a seperate subplot. Otherwise, the epithelial might dominate the frequency of other cell types. 
<font size="5"> 3. Source code </font> 


If you are interested in using my codes, feel free to download the source code below and re-appropriate them to your liking:

