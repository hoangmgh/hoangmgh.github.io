<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>📈 🌐Visualizing your WGCNA result | Hoang (Anh) Tran</title> <meta name="author" content="Hoang (Anh) Tran"> <meta name="description" content="Learn to visualize your network module in an intuitive way"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hoangmgh.github.io/blog/2023/WGCNA-vis/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script async src="https://www.googletagmanager.com/gtag/js?id={{%20site.google_analytics%20}}"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1W7V2Y0MXW");</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Hoang </span>(Anh) Tran</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Bioinformatics<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Arts</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">📈 🌐Visualizing your WGCNA result</h1> <p class="post-meta">December 11, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/visualization"> <i class="fa-solid fa-hashtag fa-sm"></i> visualization</a>     ·   <a href="/blog/category/bioinformatics"> <i class="fa-solid fa-tag fa-sm"></i> Bioinformatics</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p><strong>1. Volcano plot</strong></p> <p>After the construction of gene network modules with WGCNA, I guess one would be left with the question: what’s next? As a no-brainer step, one can screen for interesting modules that correlate with clinical features of interest. For example, I have seen people using the following heatmap to summarize the result of correlating modules with multiple clinical features:</p> <div class="row" style="text-align: center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/wgcna_heatmap-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/wgcna_heatmap-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/wgcna_heatmap-1400.webp"></source> <img src="/assets/img/wgcna_heatmap.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Lineage dotplot" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A heatmap showing the correlation of different module's eigengenes and features of interest </div> <p>However, for someone who would want to construct multiple modules from various cell-type, one can end up with a lot of network modules. In this case, a volcano plot might be useful to summarize the result of correlation between hundreds of modules and only a few variables (2-3 variables). For example, I identified quite a lot of module from just one population of epithelial cells obtained from scRNA-seq data alone:</p> <div class="row" style="text-align: center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/wgcna_volcano-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/wgcna_volcano-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/wgcna_volcano-1400.webp"></source> <img src="/assets/img/wgcna_volcano.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Lineage dotplot" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A Volcano plot showing the correlation coefficient of different module's eigengenes (x-axis) and features of interest and their corresponding p-value (y-axis) </div> <p>Of course, one can argue that the whole point of a volcano plot and a heatmap are very different. When you have a lot of clinical variables, a heatmap can be useful to highlight the bulk pattern of correlations between modules-variables as well as between variables. For only a few variable, a volcano plot might be more useful: we can do some more follow-up on the modules that pass a certain threshold for correlation.</p> <p><strong>2. Trend plot</strong></p> <p>One way to “QC” a gene module as well as visualizing its correlating pattern with a response variable is to, welp, plot all the gene expressions and the variable on the same plot. This might sound like a lot, especially when you have hundreds if not thousands of genes. One can do the following: select genes that have high module-memberships to the module, scale them to be between 0-1, and plot only those genes’ expressions (log10 CPM) against the values of the response variable; simultaneously, plotting the mean trend of the module as well, e.g. eigengene. For example, in our study, we detect an interesting module that is tightly correlated with immune-infiltration:</p> <div class="row" style="text-align: center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/e5_example-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/e5_example-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/e5_example-1400.webp"></source> <img src="/assets/img/e5_example.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Lineage dotplot" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A scatterplot showing the correlation between a gene module in Epithelial cells and immune infiltration </div> <p>You can also connect the dots with lines, so it will look more like a bunch of lines making up one overarching trend. It is quite interesting because the genes do look highly correlated to each other and to the mean-trend (the blue line). Simultaneously, the pattern is almost exponential. We actually detect these genes by correlating the log10 value of immune infiltration and the modules’ eigengenes!</p> <p>From this experience, I also realize the importance of using Module’s mean gene, as opposed to module’s eigengene to represent the overall trend of a module, as suggested by the author. Obviously, these two values represent two different thing! the module’s mean gene might be useful as we are built on the assumption that most genes are very similar and “wiggle” around a mean trend. The module’s eigengene simply is the PC1 of the genes, and not necessarily their mean, but a weighted sum of the genes that has the most variation.</p> <p><strong>3. Scatter plot</strong></p> <p>Another kind of plot you can use alongside with the trend plot is the basic scatterplot on a per gene basis. For example, here is the log10CPM of genes highly correlating with log10(immune infiltration):</p> <div class="row" style="text-align: center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/wgcna_scatterplot-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/wgcna_scatterplot-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/wgcna_scatterplot-1400.webp"></source> <img src="/assets/img/wgcna_scatterplot.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Lineage dotplot" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A scatterplot showing the correlation between a gene module in Epithelial cells and immune infiltration </div> <p>It is important to report statistics such as the correlation coefficient, and one might also add a SE band for each gene!</p> <p><strong>4. Other thoughts</strong></p> <p>I think it is important to use other kind of measures for follow-up analyses on interesting modules. One doesn’t have to use module eigengenes to represent the overall trend of a module. One can simply average the scaled values of all the genes (scaling is important here due to different dynamic range):</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">moduleMeangenes</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">!=</span><span class="n">ncol</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">print</span><span class="p">(</span><span class="s2">"the size of color vector doesnt match matrix size"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
     </span><span class="n">modules_genes</span><span class="o">=</span><span class="n">split</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span><span class="n">color</span><span class="p">)</span><span class="w">
     </span><span class="nf">names</span><span class="p">(</span><span class="n">modules_genes</span><span class="p">)</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"ME"</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">modules_genes</span><span class="p">))</span><span class="w">
        
     </span><span class="nf">return</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">modules_genes</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">matrix</span><span class="p">[,</span><span class="n">i</span><span class="p">]),</span><span class="m">1</span><span class="p">,</span><span class="n">mean</span><span class="p">)))</span><span class="w">
    
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>here \(matrix\) would be a sample \(\times\) genes, and \(color\) would be a vector assigning a group to each gene.</p> <p>At the same time, one can decide to use Pearson \(\rho\), the Kendall correlation, or the Spearman correlation for screening interesting modules. Each is simply to answer a different kind of question.</p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Hoang (Anh) Tran. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1W7V2Y0MXW"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1W7V2Y0MXW");</script> <script async src="https://rum.cronitor.io/script.js"></script> <script>window.cronitor=window.cronitor||function(){(window.cronitor.q=window.cronitor.q||[]).push(arguments)},cronitor("config",{clientKey:""});</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>